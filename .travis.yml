language: php
php:
  - "5.6"
  - "5.5"
  - "5.4"
  - "5.3"
env:
  global:
  - DB=mysql
  - secure: "rHzH5GDl7vGz1jq0Xb4WD2Z0hC94A9kHCxMrkuiZZm/oqn+Abt0mkwwO9K23GXtxEaoCQcgoF4ogs6T7lMZHaINEVfwNHix+TfF7macDWPESdHFdo01haONoPf2ZfqI5zEb28dYvYMvOwVD1r3sbadNvSSNf16lDDUx+aNUwXqw="
  - secure: "RceQiWqq7eknG2MPN8IlpdH7nfGaqe7xm17vQndfbXPuED8a87dU4lJHPWCInaqcYte1IDmYsqR59+Ksq8ryC0CbScCf+QKT6kY6FwnzzPCzTU88FrYRXXRbJdfodHb3QTRY747ek4sBdUyaG8Jq28lHH8ZbM6onqrOyylf+pA8="
addons:
  sauce_connect: true
services: memcached
install: true
branches:
  only:
    - v160
before_script:
  - cp composer.json composer.json1
  - sed --file testFramework/webtests/composer_dev.sed <composer.json1 >composer.json
  - cat composer.json
  - composer install --dev
  - mysql --execute="create database IF NOT EXISTS zencart;" --user=travis
  - echo 'date.timezone = "Europe/London"' >> ~/.phpenv/versions/$(phpenv version-name)/etc/php.ini
  - touch includes/configure.php
  - touch admin/includes/configure.php
  - cd testFramework/webtests
  - curl -s https://raw.github.com/jlipps/sausage-bun/master/givememysausage.php | php
  - cd ../..
  # set up apache server and vhost
  - sudo apt-get install apache2 libapache2-mod-fastcgi
  # enable php-fpm
  - sudo cp ~/.phpenv/versions/$(phpenv version-name)/etc/php-fpm.conf.default ~/.phpenv/versions/$(phpenv version-name)/etc/php-fpm.conf
  - sudo a2enmod rewrite actions fastcgi alias
  - echo "cgi.fix_pathinfo = 1" >> ~/.phpenv/versions/$(phpenv version-name)/etc/php.ini
  - ~/.phpenv/versions/$(phpenv version-name)/sbin/php-fpm
  # configure apache virtual hosts
  - sudo cp -f testFramework/travis-ci-apache-default /etc/apache2/sites-available/default
  - sudo cp -f testFramework/travis-ci-apache-default-ssl /etc/apache2/sites-available/default-ssl
  - sudo sed -e "s?%TRAVIS_BUILD_DIR%?$(pwd)?g" --in-place /etc/apache2/sites-available/default
  - sudo sed -e "s?%TRAVIS_BUILD_DIR%?$(pwd)?g" --in-place /etc/apache2/sites-available/default-ssl
  - sudo service apache2 restart
script:
  - phpunit -c testFramework/unittests/phpunit.xml
#uncomment the following after apache has been added
  - testFramework/webtests/vendor/bin/phpunit testFramework/webtests/allWebTests.php
